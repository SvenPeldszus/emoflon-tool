/*
 * generated by Fujaba - CodeGen2
 */
package de.uni_kassel.fujaba.codegen.rules.writers;
import java.util.Iterator;

import org.apache.velocity.context.Context;

import de.uni_kassel.fujaba.codegen.TemplateCodeWriter;
import de.uni_kassel.fujaba.codegen.rules.LinkOperation;
import de.uni_kassel.fujaba.codegen.rules.Token;
import de.uni_kassel.fujaba.codegen.rules.UMLLinkRef;
import de.uni_kassel.fujaba.codegen.rules.UMLObjectRef;
import de.uni_paderborn.fujaba.metamodel.common.FCodeStyle;
import de.uni_paderborn.fujaba.metamodel.structure.FAssoc;
import de.uni_paderborn.fujaba.metamodel.structure.FRole;
import de.uni_paderborn.fujaba.uml.behavior.UMLLink;
import de.uni_paderborn.fujaba.uml.behavior.UMLObject;
import de.uni_paderborn.fujaba.uml.behavior.UMLStoryActivity;
import de.uni_paderborn.fujaba.uml.behavior.UMLStoryPattern;
import de.upb.tools.sdm.JavaSDM;
import de.upb.tools.sdm.JavaSDMException; // requires Fujaba5/libs/RuntimeTools.jar in classpath


public class LinkCodeWriter extends TemplateCodeWriter
{


   public void fillContext (Token operation , Context context )
   {
      boolean fujaba__Success = false;
      Object _TmpObject = null;
      LinkOperation clOperation = null;
      UMLLink link = null;
      UMLLinkRef linkRef = null;
      UMLObject target = null;
      UMLObjectRef targetRef = null;
      UMLObject source = null;
      UMLStoryActivity act = null;
      Iterator fujaba__IterLinkToPattern = null;
      UMLStoryPattern pattern = null;

      // story pattern successor
      try 
      {
         fujaba__Success = false; 

         // collabStat call
         super.fillContext( operation, context );
         fujaba__Success = true;
      }
      catch ( JavaSDMException fujaba__InternalException )
      {
         fujaba__Success = false;
      }

      // story pattern 
      try 
      {
         fujaba__Success = false; 

         _TmpObject = operation;

         // ensure correct type and really bound of object clOperation
         JavaSDM.ensure ( _TmpObject instanceof LinkOperation );
         clOperation = (LinkOperation) _TmpObject;

         // search to-one link link from clOperation to linkRef
         linkRef = clOperation.getLink ();

         // check object linkRef is really bound
         JavaSDM.ensure ( linkRef != null );

         // search to-one link ref from linkRef to link
         link = linkRef.getRef ();

         // check object link is really bound
         JavaSDM.ensure ( link != null );



         // search to-one link subject from clOperation to targetRef
         targetRef = clOperation.getSubject ();

         // check object targetRef is really bound
         JavaSDM.ensure ( targetRef != null );

         // search to-one link ref from targetRef to target
         target = targetRef.getRef ();

         // check object target is really bound
         JavaSDM.ensure ( target != null );



         fujaba__Success = true;
      }
      catch ( JavaSDMException fujaba__InternalException )
      {
         fujaba__Success = false;
      }

      // story pattern successor
      try 
      {
         fujaba__Success = false; 

         // check object link is really bound
         JavaSDM.ensure ( link != null );
         // check object target is really bound
         JavaSDM.ensure ( target != null );
         // check link target from link to target
         JavaSDM.ensure (target.equals (link.getTarget ()));

         // search to-one link source from link to source
         source = link.getSource ();

         // check object source is really bound
         JavaSDM.ensure ( source != null );

         // check isomorphic binding between objects target and source
         JavaSDM.ensure ( !target.equals (source) );


         fujaba__Success = true;
      }
      catch ( JavaSDMException fujaba__InternalException )
      {
         fujaba__Success = false;
      }

      if ( !( fujaba__Success ) )
      {
         // story pattern Successor of successor
         try 
         {
            fujaba__Success = false; 

            // check object link is really bound
            JavaSDM.ensure ( link != null );
            // search to-one link target from link to source
            source = link.getTarget ();

            // check object source is really bound
            JavaSDM.ensure ( source != null );


            fujaba__Success = true;
         }
         catch ( JavaSDMException fujaba__InternalException )
         {
            fujaba__Success = false;
         }


      }
      // story pattern storypatternwiththis
      try 
      {
         fujaba__Success = false; 

         // check object context is really bound
         JavaSDM.ensure ( context != null );
         // collabStat call
         context.put ("target", target);
         // collabStat call
         context.put ("source", source);
         // collabStat call
         context.put ("elem", link);
         fujaba__Success = true;
      }
      catch ( JavaSDMException fujaba__InternalException )
      {
         fujaba__Success = false;
      }

      // story pattern 
      try 
      {
         fujaba__Success = false; 

         // check object context is really bound
         JavaSDM.ensure ( context != null );
         // check object link is really bound
         JavaSDM.ensure ( link != null );
         // iterate to-many link elements from link to pattern
         fujaba__Success = false;
         fujaba__IterLinkToPattern = link.iteratorOfDiagrams ();

         while ( !(fujaba__Success) && fujaba__IterLinkToPattern.hasNext () )
         {
            try
            {
               _TmpObject =  fujaba__IterLinkToPattern.next ();

               // ensure correct type and really bound of object pattern
               JavaSDM.ensure ( _TmpObject instanceof UMLStoryPattern );
               pattern = (UMLStoryPattern) _TmpObject;

               // search to-one link storyPattern from pattern to act
               act = pattern.getRevStoryPattern ();

               // check object act is really bound
               JavaSDM.ensure ( act != null );



               fujaba__Success = true;
            }
            catch ( JavaSDMException fujaba__InternalException )
            {
               fujaba__Success = false;
            }
         }
         JavaSDM.ensure (fujaba__Success);
         // collabStat call
         context.put ("forEach", Boolean.valueOf(act.isForEach()));
         fujaba__Success = true;
      }
      catch ( JavaSDMException fujaba__InternalException )
      {
         fujaba__Success = false;
      }

      return ;
   }

   public String getAccessStyle (Token operation )
   {
      boolean fujaba__Success = false;
      Object _TmpObject = null;
      LinkOperation linkOp = null;
      UMLLink link = null;
      UMLLinkRef linkRef = null;
      UMLObject target = null;
      UMLObjectRef objRef = null;
      FAssoc assoc = null;
      FCodeStyle accessStyle = null;
      UMLObject source = null;
      FRole role = null;

      // story pattern storypatternwiththis
      try 
      {
         fujaba__Success = false; 

         _TmpObject = operation;

         // ensure correct type and really bound of object linkOp
         JavaSDM.ensure ( _TmpObject instanceof LinkOperation );
         linkOp = (LinkOperation) _TmpObject;

         // search to-one link link from linkOp to linkRef
         linkRef = linkOp.getLink ();

         // check object linkRef is really bound
         JavaSDM.ensure ( linkRef != null );

         // search to-one link ref from linkRef to link
         link = linkRef.getRef ();

         // check object link is really bound
         JavaSDM.ensure ( link != null );



         // search to-one link subject from linkOp to objRef
         objRef = linkOp.getSubject ();

         // check object objRef is really bound
         JavaSDM.ensure ( objRef != null );

         // search to-one link ref from objRef to target
         target = objRef.getRef ();

         // check object target is really bound
         JavaSDM.ensure ( target != null );



         fujaba__Success = true;
      }
      catch ( JavaSDMException fujaba__InternalException )
      {
         fujaba__Success = false;
      }

      // story pattern 
      try 
      {
         fujaba__Success = false; 

         // check object link is really bound
         JavaSDM.ensure ( link != null );
         // search to-one link instanceOf from link to assoc
         assoc = link.getInstanceOf ();

         // check object assoc is really bound
         JavaSDM.ensure ( assoc != null );


         fujaba__Success = true;
      }
      catch ( JavaSDMException fujaba__InternalException )
      {
         fujaba__Success = false;
      }

      if ( !( fujaba__Success ) )
      {
         // // use source for pathes
         // story pattern successor
         try 
         {
            fujaba__Success = false; 

            // check object link is really bound
            JavaSDM.ensure ( link != null );
            // search to-one link source from link to source
            source = link.getSource ();

            // check object source is really bound
            JavaSDM.ensure ( source != null );

            // search to-one link inheritedCodeStyle from source to accessStyle
            accessStyle = source.getInheritedCodeStyle ();

            // check object accessStyle is really bound
            JavaSDM.ensure ( accessStyle != null );



            fujaba__Success = true;
         }
         catch ( JavaSDMException fujaba__InternalException )
         {
            fujaba__Success = false;
         }

         if ( fujaba__Success )
         {
            return accessStyle.getName();

         }
         return null;

      }
      // story pattern Successor of storypatternwiththis
      try 
      {
         fujaba__Success = false; 

         // check object assoc is really bound
         JavaSDM.ensure ( assoc != null );
         // check object link is really bound
         JavaSDM.ensure ( link != null );
         // check object target is really bound
         JavaSDM.ensure ( target != null );
         // check link instanceOf from link to assoc
         JavaSDM.ensure (assoc.equals (link.getInstanceOf ()));

         // search to-one link leftRole from assoc to role
         role = assoc.getLeftRole ();

         // check object role is really bound
         JavaSDM.ensure ( role != null );


         // check link source from link to target
         JavaSDM.ensure (target.equals (link.getSource ()));

         fujaba__Success = true;
      }
      catch ( JavaSDMException fujaba__InternalException )
      {
         fujaba__Success = false;
      }

      if ( !( fujaba__Success ) )
      {
         // story pattern Successor of Successor of storypatternwiththis
         try 
         {
            fujaba__Success = false; 

            // check object assoc is really bound
            JavaSDM.ensure ( assoc != null );
            // check object link is really bound
            JavaSDM.ensure ( link != null );
            // check object target is really bound
            JavaSDM.ensure ( target != null );
            // check link instanceOf from link to assoc
            JavaSDM.ensure (assoc.equals (link.getInstanceOf ()));

            // search to-one link rightRole from assoc to role
            role = assoc.getRightRole ();

            // check object role is really bound
            JavaSDM.ensure ( role != null );


            // check link target from link to target
            JavaSDM.ensure (target.equals (link.getTarget ()));

            fujaba__Success = true;
         }
         catch ( JavaSDMException fujaba__InternalException )
         {
            fujaba__Success = false;
         }


      }
      // story pattern Successor of Successor of storypatternwiththis
      try 
      {
         fujaba__Success = false; 

         // check object role is really bound
         JavaSDM.ensure ( role != null );
         // search to-one link inheritedCodeStyle from role to accessStyle
         accessStyle = role.getInheritedCodeStyle ();

         // check object accessStyle is really bound
         JavaSDM.ensure ( accessStyle != null );


         fujaba__Success = true;
      }
      catch ( JavaSDMException fujaba__InternalException )
      {
         fujaba__Success = false;
      }

      if ( fujaba__Success )
      {
         return accessStyle.getName();

      }
      return null;
   }

}


