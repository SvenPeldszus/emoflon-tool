/*
 * generated by Fujaba - CodeGen2
 */
package de.uni_kassel.fujaba.codegen.rules.engine;
import java.util.Iterator;

import de.uni_kassel.fujaba.codegen.rules.CollabStatOperation;
import de.uni_kassel.fujaba.codegen.rules.ExecuteStoryPatternOperation;
import de.uni_kassel.fujaba.codegen.rules.ObjectSet;
import de.uni_kassel.fujaba.codegen.rules.UMLObjectRef;
import de.uni_paderborn.fujaba.uml.behavior.UMLCollabStat;
import de.uni_paderborn.fujaba.uml.behavior.UMLObject;
import de.uni_paderborn.fujaba.uml.behavior.UMLStoryPattern;
import de.upb.tools.sdm.JavaSDM; // requires Fujaba5/libs/RuntimeTools.jar in classpath
import de.upb.tools.sdm.JavaSDMException;


public class AddCollabStatsMutator extends PlanMutator
{


   protected void addCollabStats (ExecuteStoryPatternOperation plan , UMLCollabStat collabStat )
   {
      boolean fujaba__Success = false;
      CollabStatOperation csOP = null;
      UMLObject obj = null;
      ObjectSet set = null;
      UMLObjectRef objRef = null;
      Iterator fujaba__IterCollabStatToChildStat = null;
      UMLCollabStat childStat = null;

      // story pattern Successor of Successor of storypatternwiththis
      try 
      {
         fujaba__Success = false; 

         // check object collabStat is really bound
         JavaSDM.ensure ( collabStat != null );
         // iterate to-many link orderedSubStats from collabStat to childStat
         fujaba__Success = false;
         fujaba__IterCollabStatToChildStat = collabStat.iteratorOfOrderedSubStats ();

         while ( fujaba__IterCollabStatToChildStat.hasNext () )
         {
            try
            {
               childStat = (UMLCollabStat) fujaba__IterCollabStatToChildStat.next ();

               // check object childStat is really bound
               JavaSDM.ensure ( childStat != null );
               // check isomorphic binding between objects collabStat and childStat
               JavaSDM.ensure ( !collabStat.equals (childStat) );

               // story pattern Successor of Successor of Successor of storypatternwiththis
               try 
               {
                  fujaba__Success = false; 

                  // check object childStat is really bound
                  JavaSDM.ensure ( childStat != null );
                  // check object plan is really bound
                  JavaSDM.ensure ( plan != null );
                  // create object csOP
                  csOP = new CollabStatOperation ( );

                  // create link operations from csOP to plan
                  csOP.setStoryPatternOperation (plan);

                  // create link element from csOP to childStat
                  csOP.setElement (childStat);

                  // collabStat call
                  addCollabStats (plan, childStat);
                  fujaba__Success = true;
               }
               catch ( JavaSDMException fujaba__InternalException )
               {
                  fujaba__Success = false;
               }

               // story pattern Successor of Successor of Successor of Successor of storypatternwiththis
               try 
               {
                  fujaba__Success = false; 

                  // check object childStat is really bound
                  JavaSDM.ensure ( childStat != null );
                  // check object plan is really bound
                  JavaSDM.ensure ( plan != null );
                  // search to-one link callTarget from childStat to obj
                  obj = childStat.getCallTarget ();

                  // check object obj is really bound
                  JavaSDM.ensure ( obj != null );


                  // search to-one link objects from plan to set
                  set = plan.getObjects ();

                  // check object set is really bound
                  JavaSDM.ensure ( set != null );


                  fujaba__Success = true;
               }
               catch ( JavaSDMException fujaba__InternalException )
               {
                  fujaba__Success = false;
               }

               if ( fujaba__Success )
               {
                  // story pattern 
                  try 
                  {
                     fujaba__Success = false; 

                     // check object set is really bound
                     JavaSDM.ensure ( set != null );
                     // search to-one link items from set to objRef
                     objRef = set.getFromItems (obj);

                     // check object objRef is really bound
                     JavaSDM.ensure ( objRef != null );


                     fujaba__Success = true;
                  }
                  catch ( JavaSDMException fujaba__InternalException )
                  {
                     fujaba__Success = false;
                  }

                  if ( !( fujaba__Success ) )
                  {
                     // story pattern storypatternwiththis
                     try 
                     {
                        fujaba__Success = false; 

                        // check object obj is really bound
                        JavaSDM.ensure ( obj != null );
                        // create object objRef
                        objRef = new UMLObjectRef ( );

                        // create link ref from objRef to obj
                        objRef.setRef (obj);

                        fujaba__Success = true;
                     }
                     catch ( JavaSDMException fujaba__InternalException )
                     {
                        fujaba__Success = false;
                     }


                  }
                  // story pattern 
                  try 
                  {
                     fujaba__Success = false; 

                     // check object csOP is really bound
                     JavaSDM.ensure ( csOP != null );
                     // check object objRef is really bound
                     JavaSDM.ensure ( objRef != null );
                     // create link subject from csOP to objRef
                     csOP.setSubject (objRef);

                     // create link needs from csOP to objRef
                     csOP.addToNeeds (objRef);

                     fujaba__Success = true;
                  }
                  catch ( JavaSDMException fujaba__InternalException )
                  {
                     fujaba__Success = false;
                  }


               }

               fujaba__Success = true;
            }
            catch ( JavaSDMException fujaba__InternalException )
            {
               fujaba__Success = false;
            }
         }
         JavaSDM.ensure (fujaba__Success);
         fujaba__Success = true;
      }
      catch ( JavaSDMException fujaba__InternalException )
      {
         fujaba__Success = false;
      }

      return ;
   }

   public void mutate (ExecuteStoryPatternOperation plan )
   {
      boolean fujaba__Success = false;
      UMLCollabStat master = null;
      UMLStoryPattern story = null;

      // story pattern find master collab stat
      try 
      {
         fujaba__Success = false; 

         // check object plan is really bound
         JavaSDM.ensure ( plan != null );
         // search to-one link storyPattern from plan to story
         story = plan.getStoryPattern ();

         // check object story is really bound
         JavaSDM.ensure ( story != null );

         // search to-one link masterCollabStat from story to master
         master = story.getRevMasterCollabStat ();

         // check object master is really bound
         JavaSDM.ensure ( master != null );



         // collabStat call
         addCollabStats (plan, master);
         fujaba__Success = true;
      }
      catch ( JavaSDMException fujaba__InternalException )
      {
         fujaba__Success = false;
      }

      return ;
   }

}


