/*
 * generated by Fujaba - CodeGen2
 */
package de.uni_kassel.fujaba.codegen.rules;
import java.util.Iterator;

import de.uni_kassel.features.ReferenceHandler; // requires Fujaba5/libs/features.jar in classpath
import de.uni_kassel.features.annotation.util.Property; // requires Fujaba5/libs/features.jar in classpath
import de.upb.tools.sdm.JavaSDM; // requires Fujaba5/libs/RuntimeTools.jar in classpath
import de.upb.tools.sdm.JavaSDMException;


public class SearchOperation extends LinkOperation implements PreCondition, Composite
{


   public LinkOperation getReverseOperation ()
   {
      boolean fujaba__Success = false;
      Iterator fujaba__IterThisToNeeds = null;
      UMLObjectRef needs = null;
      Iterator fujaba__IterLinkToReverse = null;
      Object _TmpObject = null;
      SearchOperation reverse = null;
      UMLLinkRef link = null;
      UMLObjectRef subject = null;

      // story pattern storypatternwiththis
      try 
      {
         fujaba__Success = false; 

         // search to-one link subject from this to subject
         subject = this.getSubject ();

         // check object subject is really bound
         JavaSDM.ensure ( subject != null );

         // search to-one link link from this to link
         link = this.getLink ();

         // check object link is really bound
         JavaSDM.ensure ( link != null );

         // iterate to-many link link from link to reverse
         fujaba__Success = false;
         fujaba__IterLinkToReverse = link.iteratorOfLinkTo ();

         while ( !(fujaba__Success) && fujaba__IterLinkToReverse.hasNext () )
         {
            try
            {
               _TmpObject =  fujaba__IterLinkToReverse.next ();

               // ensure correct type and really bound of object reverse
               JavaSDM.ensure ( _TmpObject instanceof SearchOperation );
               reverse = (SearchOperation) _TmpObject;

               // check isomorphic binding between objects this and reverse
               JavaSDM.ensure ( !this.equals (reverse) );

               // check link needs from reverse to subject
               JavaSDM.ensure (reverse.hasInNeeds (subject));

               // iterate to-many link needs from this to needs
               fujaba__Success = false;
               fujaba__IterThisToNeeds = this.iteratorOfNeeds ();

               while ( !(fujaba__Success) && fujaba__IterThisToNeeds.hasNext () )
               {
                  try
                  {
                     needs = (UMLObjectRef) fujaba__IterThisToNeeds.next ();

                     // check object needs is really bound
                     JavaSDM.ensure ( needs != null );
                     // check isomorphic binding between objects subject and needs
                     JavaSDM.ensure ( !subject.equals (needs) );

                     // check link subject from reverse to needs
                     JavaSDM.ensure (needs.equals (reverse.getSubject ()));


                     fujaba__Success = true;
                  }
                  catch ( JavaSDMException fujaba__InternalException )
                  {
                     fujaba__Success = false;
                  }
               }
               JavaSDM.ensure (fujaba__Success);

               fujaba__Success = true;
            }
            catch ( JavaSDMException fujaba__InternalException )
            {
               fujaba__Success = false;
            }
         }
         JavaSDM.ensure (fujaba__Success);


         fujaba__Success = true;
      }
      catch ( JavaSDMException fujaba__InternalException )
      {
         fujaba__Success = false;
      }

      if ( fujaba__Success )
      {
         return reverse;

      }
      return null;
   }

   /**
    * <pre>
    *           0..1     supersedes     0..1
    * SearchOperation ------------------------- CheckLinkOperation
    *           supersedes               supersedes
    * </pre>
    */
   public static final String PROPERTY_SUPERSEDES = "supersedes";

   @Property( name = PROPERTY_SUPERSEDES, partner = CheckLinkOperation.PROPERTY_SUPERSEDES, kind = ReferenceHandler.ReferenceKind.TO_ONE,
         adornment = ReferenceHandler.Adornment.NONE)
   private CheckLinkOperation supersedes;

   @Property( name = PROPERTY_SUPERSEDES )
   public boolean setSupersedes (CheckLinkOperation value)
   {
      boolean changed = false;

      if (this.supersedes != value)
      {
      
         CheckLinkOperation oldValue = this.supersedes;
         SearchOperation source = this;
         if (this.supersedes != null)
         {
            this.supersedes = null;
            oldValue.setSupersedes (null);
         }
         this.supersedes = value;

         if (value != null)
         {
            value.setSupersedes (this);
         }
         changed = true;
      
      }
      return changed;
   }

   @Property( name = PROPERTY_SUPERSEDES )
   public SearchOperation withSupersedes (CheckLinkOperation value)
   {
      setSupersedes (value);
      return this;
   }

   public CheckLinkOperation getSupersedes ()
   {
      return this.supersedes;
   }

   public void removeYou()
   {
      this.setSupersedes (null);
      super.removeYou ();
   }
}


