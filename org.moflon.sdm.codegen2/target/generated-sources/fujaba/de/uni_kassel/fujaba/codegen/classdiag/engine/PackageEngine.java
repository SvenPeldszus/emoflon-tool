/*
 * generated by Fujaba - CodeGen2
 */
package de.uni_kassel.fujaba.codegen.classdiag.engine;
import java.util.Iterator;

import de.uni_kassel.fujaba.codegen.classdiag.ASGElementToken;
import de.uni_kassel.fujaba.codegen.engine.TokenCreationEngine;
import de.uni_kassel.fujaba.codegen.rules.Token;
import de.uni_paderborn.fujaba.metamodel.common.FElement;
import de.uni_paderborn.fujaba.metamodel.common.FFile;
import de.uni_paderborn.fujaba.metamodel.structure.FClass;
import de.uni_paderborn.fujaba.metamodel.structure.FPackage;
import de.upb.tools.sdm.JavaSDM; // requires Fujaba5/libs/RuntimeTools.jar in classpath
import de.upb.tools.sdm.JavaSDMException;


public class PackageEngine extends TokenCreationEngine
{


   public Token createToken (FElement element )
   {
      boolean fujaba__Success = false;
      Object _TmpObject = null;
      FPackage umlPackage = null;
      ASGElementToken token = null;
      Iterator fujaba__IterUmlPackageToSubPackage = null;
      FPackage subPackage = null;
      Iterator fujaba__IterTokenToFileToken = null;
      ASGElementToken fileToken = null;
      FFile file = null;
      Iterator fujaba__IterUmlPackageToClazz = null;
      FClass clazz = null;

      // story pattern storypatternwiththis
      try 
      {
         fujaba__Success = false; 

         _TmpObject = element;

         // ensure correct type and really bound of object umlPackage
         JavaSDM.ensure ( _TmpObject instanceof FPackage );
         umlPackage = (FPackage) _TmpObject;

         // create object token
         token = new ASGElementToken ( );

         // create link element from token to umlPackage
         token.setElement (umlPackage);

         fujaba__Success = true;
      }
      catch ( JavaSDMException fujaba__InternalException )
      {
         fujaba__Success = false;
      }

      // story pattern successor
      try 
      {
         fujaba__Success = false; 

         // check object umlPackage is really bound
         JavaSDM.ensure ( umlPackage != null );
         // iterate to-many link packages from umlPackage to subPackage
         fujaba__Success = false;
         fujaba__IterUmlPackageToSubPackage = umlPackage.iteratorOfPackages ();

         while ( fujaba__IterUmlPackageToSubPackage.hasNext () )
         {
            try
            {
               subPackage = (FPackage) fujaba__IterUmlPackageToSubPackage.next ();

               // check object subPackage is really bound
               JavaSDM.ensure ( subPackage != null );
               // check isomorphic binding between objects umlPackage and subPackage
               JavaSDM.ensure ( !umlPackage.equals (subPackage) );

               // collabStat call
               this.createToken (subPackage, token);

               fujaba__Success = true;
            }
            catch ( JavaSDMException fujaba__InternalException )
            {
               fujaba__Success = false;
            }
         }
         JavaSDM.ensure (fujaba__Success);
         fujaba__Success = true;
      }
      catch ( JavaSDMException fujaba__InternalException )
      {
         fujaba__Success = false;
      }

      // story pattern Successor of successor
      try 
      {
         fujaba__Success = false; 

         // check object umlPackage is really bound
         JavaSDM.ensure ( umlPackage != null );
         // iterate to-many link declaredInPackage from umlPackage to clazz
         fujaba__Success = false;
         fujaba__IterUmlPackageToClazz = umlPackage.iteratorOfDeclares ();

         while ( fujaba__IterUmlPackageToClazz.hasNext () )
         {
            try
            {
               clazz = (FClass) fujaba__IterUmlPackageToClazz.next ();

               // check object clazz is really bound
               JavaSDM.ensure ( clazz != null );
               // search to-one link hasClasses from clazz to file
               file = clazz.getFile ();

               // check object file is really bound
               JavaSDM.ensure ( file != null );

               // story pattern storypatternwiththis
               try 
               {
                  fujaba__Success = false; 

                  // check object file is really bound
                  JavaSDM.ensure ( file != null );
                  // check object token is really bound
                  JavaSDM.ensure ( token != null );
                  // iterate to-many link children from token to fileToken
                  fujaba__Success = false;
                  fujaba__IterTokenToFileToken = token.iteratorOfChildren ();

                  while ( !(fujaba__Success) && fujaba__IterTokenToFileToken.hasNext () )
                  {
                     try
                     {
                        _TmpObject =  fujaba__IterTokenToFileToken.next ();

                        // ensure correct type and really bound of object fileToken
                        JavaSDM.ensure ( _TmpObject instanceof ASGElementToken );
                        fileToken = (ASGElementToken) _TmpObject;

                        // check isomorphic binding between objects token and fileToken
                        JavaSDM.ensure ( !token.equals (fileToken) );

                        // check link element from fileToken to file
                        JavaSDM.ensure (file.equals (fileToken.getElement ()));


                        fujaba__Success = true;
                     }
                     catch ( JavaSDMException fujaba__InternalException )
                     {
                        fujaba__Success = false;
                     }
                  }
                  JavaSDM.ensure (fujaba__Success);
                  fujaba__Success = true;
               }
               catch ( JavaSDMException fujaba__InternalException )
               {
                  fujaba__Success = false;
               }

               if ( !( fujaba__Success ) )
               {
                  // story pattern storypatternwiththis
                  try 
                  {
                     fujaba__Success = false; 

                     // collabStat call
                     this.createToken (file, token);
                     fujaba__Success = true;
                  }
                  catch ( JavaSDMException fujaba__InternalException )
                  {
                     fujaba__Success = false;
                  }


               }


               fujaba__Success = true;
            }
            catch ( JavaSDMException fujaba__InternalException )
            {
               fujaba__Success = false;
            }
         }
         JavaSDM.ensure (fujaba__Success);
         fujaba__Success = true;
      }
      catch ( JavaSDMException fujaba__InternalException )
      {
         fujaba__Success = false;
      }

      if ( !( token.sizeOfChildren() > 0 ) )
      {
         return null;

      }
      return token;
   }

   public boolean isResponsible (FElement element )
   {
      boolean fujaba__Success = false;
      Object _TmpObject = null;
      FPackage umlPackage = null;

      // story pattern 
      try 
      {
         fujaba__Success = false; 

         _TmpObject = element;

         // ensure correct type and really bound of object umlPackage
         JavaSDM.ensure ( _TmpObject instanceof FPackage );
         umlPackage = (FPackage) _TmpObject;

         fujaba__Success = true;
      }
      catch ( JavaSDMException fujaba__InternalException )
      {
         fujaba__Success = false;
      }

      if ( fujaba__Success )
      {
         return true;

      }
      return false;
   }

}


